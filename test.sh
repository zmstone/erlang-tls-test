#!/bin/bash

set -e

ciphers=("ECDHE-ECDSA-AES256-GCM-SHA384" "ECDHE-RSA-AES256-GCM-SHA384" "ECDHE-ECDSA-AES256-CCM"
"ECDHE-ECDSA-AES256-CCM8" "ECDHE-ECDSA-AES256-SHA384" "ECDHE-RSA-AES256-SHA384" "ECDHE-ECDSA-CHACHA20-POLY1305"
"ECDHE-RSA-CHACHA20-POLY1305" "ECDHE-ECDSA-AES128-GCM-SHA256" "ECDHE-RSA-AES128-GCM-SHA256" "ECDHE-ECDSA-AES128-CCM"
"ECDHE-ECDSA-AES128-CCM8" "ECDH-ECDSA-AES256-GCM-SHA384" "ECDH-RSA-AES256-GCM-SHA384" "ECDH-ECDSA-AES256-SHA384"
"ECDH-RSA-AES256-SHA384" "ECDH-ECDSA-AES128-GCM-SHA256" "ECDH-RSA-AES128-GCM-SHA256" "ECDHE-ECDSA-AES128-SHA256"
"ECDHE-RSA-AES128-SHA256" "ECDH-ECDSA-AES128-SHA256" "ECDH-RSA-AES128-SHA256" "DHE-RSA-AES256-GCM-SHA384"
"DHE-DSS-AES256-GCM-SHA384" "DHE-RSA-AES256-SHA256" "DHE-DSS-AES256-SHA256" "DHE-RSA-AES128-GCM-SHA256"
"DHE-DSS-AES128-GCM-SHA256" "DHE-RSA-CHACHA20-POLY1305" "DHE-RSA-AES128-SHA256" "DHE-DSS-AES128-SHA256")

for i in "${ciphers[@]}"; do
    if openssl s_client -connect localhost:8883 -CAfile ~/src/emqx/1/etc/certs/cacert.pem -tls1_2 -cipher "$i" </dev/null >/dev/null 2>&1; then
        echo "$i ............... OK"
    else
        echo "$i nok"
    fi
done
